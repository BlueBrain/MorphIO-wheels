env:
  global:
    - REPO_DIR=MorphIO
    - BUILD_COMMIT=HEAD
    - BUILD_DEPENDS="numpy"
    - TEST_DEPENDS="numpy nose"
    - PLAT=x86_64
    - UNICODE_WIDTH=32
    - MB_ML_VER=2010

dist: trusty
language: generic
services: docker

jobs:
  include:
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.8

          #    - os: osx
          #      env:
          #        - MB_PYTHON_VERSION=2.7
          #    - os: osx
          #      env:
          #        - MB_PYTHON_VERSION=3.6
          #    - os: osx
          #      env:
          #        - MB_PYTHON_VERSION=3.7
          #    - os: osx
          #      env:
          #        - MB_PYTHON_VERSION=3.8

before_install:
    - source multibuild/common_utils.sh
    - source multibuild/travis_steps.sh
    - clean_code $REPO_DIR $BUILD_COMMIT
    - before_install

install:
    - build_wheel $REPO_DIR $PLAT

script:
    - install_run $PLAT

after_success:
    - mkdir -p dist; cp ${TRAVIS_BUILD_DIR}/wheelhouse/*.whl dist
    - pip install twine
    - twine upload --repository-url https://test.pypi.org/legacy/ --verbose -u bbp.opensource -p $PYPI_PASSWORD dist/*

